{% extends "finance/base.html" %}
{% load static %}

{% block title %}Investimentos{% endblock %}

{% block content %}
<h1>Investimentos</h1>

<!-- Seção 1: Resumo Geral -->
<div style="background-color: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2 style="margin-top: 0;">Resumo Geral</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <div style="background: white; padding: 15px; border-radius: 6px;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Saldo Total Pendente</div>
            <div style="font-size: 24px; font-weight: bold; color: #ff9800;">R$ {{ total_pending|floatformat:2 }}</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 6px;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Total Investido</div>
            <div style="font-size: 24px; font-weight: bold; color: #283593;">R$ {{ total_invested|floatformat:2 }}</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 6px;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Total Aportado</div>
            <div style="font-size: 24px; font-weight: bold; color: #555;">R$ {{ total_contributed|floatformat:2 }}</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 6px;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Rendimento Global</div>
            <div style="font-size: 24px; font-weight: bold; color: {% if global_return >= 0 %}#2e7d32{% else %}#c62828{% endif %};">
                R$ {{ global_return|floatformat:2 }} ({{ global_return_percentage|floatformat:2 }}%)
            </div>
        </div>
    </div>
</div>

<!-- Seção 2: Valores em Análise -->
<div style="background-color: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #ffc107;">
    <h2 style="margin-top: 0;">Valores em Análise</h2>
    <p style="font-size: 18px; font-weight: bold; margin-bottom: 15px;">
        Saldo disponível para alocação: <span style="color: #ff6f00;">R$ {{ total_pending|floatformat:2 }}</span>
    </p>
    <button onclick="openAllocateModal()" style="padding: 10px 20px; background-color: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
        Alocar Investimento
    </button>
</div>

<!-- Seção 3: Investimentos -->
<div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2 style="margin-top: 0;">Investimentos</h2>
    
    {% if investments %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f5f5f5;">
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Corretora</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Tipo</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Nome</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Saldo Atual</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Total Aportado</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Rendimento</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Status</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for inv in investments %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 12px;">{{ inv.broker }}</td>
                    <td style="padding: 12px;">{{ inv.investment_type }}</td>
                    <td style="padding: 12px;">{{ inv.name }}</td>
                    <td style="padding: 12px; text-align: right;">R$ {{ inv.current_balance|floatformat:2 }}</td>
                    <td style="padding: 12px; text-align: right;">R$ {{ inv.total_contributed|floatformat:2 }}</td>
                    <td style="padding: 12px; text-align: right; color: {% if inv.return_amount >= 0 %}#2e7d32{% else %}#c62828{% endif %};">
                        R$ {{ inv.return_amount|floatformat:2 }} ({{ inv.return_percentage|floatformat:2 }}%)
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="padding: 4px 8px; border-radius: 4px; background-color: {% if inv.status == 'ativo' %}#4caf50{% else %}#9e9e9e{% endif %}; color: white; font-size: 12px;">
                            {{ inv.status_display }}
                        </span>
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <button onclick="openEditModal({{ inv.id }}, '{{ inv.broker }}', {{ inv.broker_id|default:0 }}, {{ inv.investment_type_id }}, '{{ inv.name }}')" style="padding: 5px 10px; margin: 2px; background-color: #2196f3; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Editar</button>
                        <button onclick="openUpdateBalanceModal({{ inv.id }}, '{{ inv.broker }} - {{ inv.name }}', {{ inv.current_balance }})" style="padding: 5px 10px; margin: 2px; background-color: #9c27b0; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Atualizar Saldo</button>
                        <button onclick="openAddContributionModal({{ inv.id }}, '{{ inv.broker }} - {{ inv.name }}')" style="padding: 5px 10px; margin: 2px; background-color: #ff9800; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Aporte</button>
                        <button onclick="openRedeemModal({{ inv.id }}, '{{ inv.broker }} - {{ inv.name }}', {{ inv.current_balance }})" style="padding: 5px 10px; margin: 2px; background-color: #f44336; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Resgatar</button>
                        <button onclick="openUpdateStatusModal({{ inv.id }}, '{{ inv.broker }} - {{ inv.name }}', '{{ inv.status }}')" style="padding: 5px 10px; margin: 2px; background-color: #607d8b; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Status</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="color: #999; font-style: italic;">Nenhum investimento cadastrado.</p>
    {% endif %}
</div>

<!-- Modal: Alocar Investimento -->
<div id="allocateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%;">
        <h2 style="margin-top: 0;">Alocar Investimento</h2>
        <form method="post" action="{% url 'investment:investments' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="allocate_pending">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Valor a alocar:</label>
                <input type="number" name="amount" step="0.01" min="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Investimento:</label>
                <select id="allocateInvestmentSelect" name="investment_select" onchange="toggleAllocateNewInvestment()" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">--- Criar novo investimento ---</option>
                    {% for inv in investments %}
                    <option value="{{ inv.id }}">{{ inv.broker }} - {{ inv.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div id="newInvestmentFields" style="display: block;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Corretora:</label>
                    <select name="broker_id" id="allocateBrokerId" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        {% for broker in brokers %}
                        <option value="{{ broker.id }}">{{ broker.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Tipo de Investimento:</label>
                    <select name="investment_type_id" id="allocateInvestmentTypeId" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        {% for it in investment_types %}
                        <option value="{{ it.id }}">{{ it.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Nome:</label>
                    <input type="text" name="name" id="allocateInvestmentName" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Data da transação:</label>
                <input type="date" name="transaction_date" required value="{% now 'Y-m-d' %}" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeAllocateModal()" style="padding: 10px 20px; background-color: #999; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 20px; background-color: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">Alocar</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Atualizar Saldo -->
<div id="updateBalanceModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
        <h2 style="margin-top: 0;">Atualizar Saldo</h2>
        <form method="post" action="{% url 'investment:investments' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_balance">
            <input type="hidden" id="updateBalanceInvestmentId" name="investment_id">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Investimento:</label>
                <input type="text" id="updateBalanceInvestmentName" readonly style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #f5f5f5;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Novo saldo:</label>
                <input type="number" name="new_balance" id="updateBalanceNewBalance" step="0.01" min="0" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Data da transação:</label>
                <input type="date" name="transaction_date" required value="{% now 'Y-m-d' %}" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeUpdateBalanceModal()" style="padding: 10px 20px; background-color: #999; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 20px; background-color: #9c27b0; color: white; border: none; border-radius: 4px; cursor: pointer;">Atualizar</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Adicionar Aporte -->
<div id="addContributionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
        <h2 style="margin-top: 0;">Adicionar Aporte</h2>
        <form method="post" action="{% url 'investment:investments' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_contribution">
            <input type="hidden" id="addContributionInvestmentId" name="investment_id">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Investimento:</label>
                <input type="text" id="addContributionInvestmentName" readonly style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #f5f5f5;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Valor a aportar:</label>
                <input type="number" name="amount" step="0.01" min="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Data da transação:</label>
                <input type="date" name="transaction_date" required value="{% now 'Y-m-d' %}" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeAddContributionModal()" style="padding: 10px 20px; background-color: #999; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 20px; background-color: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">Adicionar Aporte</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Resgatar Investimento -->
<div id="redeemModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
        <h2 style="margin-top: 0;">Resgatar Investimento</h2>
        <form method="post" action="{% url 'investment:investments' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="redeem_investment">
            <input type="hidden" id="redeemInvestmentId" name="investment_id">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Investimento:</label>
                <input type="text" id="redeemInvestmentName" readonly style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #f5f5f5;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Valor a resgatar:</label>
                <input type="number" name="amount" id="redeemAmount" step="0.01" min="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Conta:</label>
                <select name="account_id" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    {% for account in accounts %}
                    <option value="{{ account.id }}">{{ account.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Data da transação:</label>
                <input type="date" name="transaction_date" required value="{% now 'Y-m-d' %}" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeRedeemModal()" style="padding: 10px 20px; background-color: #999; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 20px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Resgatar</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Editar Investimento -->
<div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%;">
        <h2 style="margin-top: 0;">Editar Investimento</h2>
        <form method="post" action="{% url 'investment:investments' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="edit_investment">
            <input type="hidden" id="editInvestmentId" name="investment_id">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Investimento (atual):</label>
                <input type="text" id="editInvestmentNameDisplay" readonly style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #f5f5f5;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Corretora:</label>
                <select name="broker_id" id="editBrokerId" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    {% for broker in brokers %}
                    <option value="{{ broker.id }}">{{ broker.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Tipo de Investimento:</label>
                <select name="investment_type_id" id="editInvestmentTypeId" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    {% for it in investment_types %}
                    <option value="{{ it.id }}">{{ it.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Nome:</label>
                <input type="text" name="name" id="editInvestmentName" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeEditModal()" style="padding: 10px 20px; background-color: #999; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 20px; background-color: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Alterar Status -->
<div id="updateStatusModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
        <h2 style="margin-top: 0;">Alterar Status</h2>
        <form method="post" action="{% url 'investment:investments' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_status">
            <input type="hidden" id="updateStatusInvestmentId" name="investment_id">
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Investimento:</label>
                <input type="text" id="updateStatusInvestmentName" readonly style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #f5f5f5;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Status:</label>
                <select name="status" id="updateStatusStatus" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="ativo">Ativo</option>
                    <option value="resgatado">Resgatado</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="closeUpdateStatusModal()" style="padding: 10px 20px; background-color: #999; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="padding: 10px 20px; background-color: #607d8b; color: white; border: none; border-radius: 4px; cursor: pointer;">Alterar Status</button>
            </div>
        </form>
    </div>
</div>

<script>
// Funções para abrir/fechar modais
function openAllocateModal() {
    document.getElementById('allocateModal').style.display = 'block';
}

function closeAllocateModal() {
    document.getElementById('allocateModal').style.display = 'none';
}

function toggleAllocateNewInvestment() {
    const select = document.getElementById('allocateInvestmentSelect');
    const newFields = document.getElementById('newInvestmentFields');
    if (select.value === '') {
        newFields.style.display = 'block';
        // Tornar campos obrigatórios
        document.getElementById('allocateBrokerId').required = true;
        document.getElementById('allocateInvestmentTypeId').required = true;
        document.getElementById('allocateInvestmentName').required = true;
    } else {
        newFields.style.display = 'none';
        // Remover obrigatoriedade
        document.getElementById('allocateBrokerId').required = false;
        document.getElementById('allocateInvestmentTypeId').required = false;
        document.getElementById('allocateInvestmentName').required = false;
        // Limpar valores
        document.getElementById('allocateBrokerId').value = '';
        document.getElementById('allocateInvestmentTypeId').value = '';
        document.getElementById('allocateInvestmentName').value = '';
    }
}

function openUpdateBalanceModal(investmentId, investmentName, currentBalance) {
    document.getElementById('updateBalanceInvestmentId').value = investmentId;
    document.getElementById('updateBalanceInvestmentName').value = investmentName;
    document.getElementById('updateBalanceNewBalance').value = parseFloat(currentBalance).toFixed(2);
    document.getElementById('updateBalanceModal').style.display = 'block';
}

function closeUpdateBalanceModal() {
    document.getElementById('updateBalanceModal').style.display = 'none';
}

function openAddContributionModal(investmentId, investmentName) {
    document.getElementById('addContributionInvestmentId').value = investmentId;
    document.getElementById('addContributionInvestmentName').value = investmentName;
    document.getElementById('addContributionModal').style.display = 'block';
}

function closeAddContributionModal() {
    document.getElementById('addContributionModal').style.display = 'none';
}

function openRedeemModal(investmentId, investmentName, currentBalance) {
    document.getElementById('redeemInvestmentId').value = investmentId;
    document.getElementById('redeemInvestmentName').value = investmentName;
    document.getElementById('redeemAmount').max = parseFloat(currentBalance);
    document.getElementById('redeemAmount').value = parseFloat(currentBalance).toFixed(2);
    document.getElementById('redeemModal').style.display = 'block';
}

function closeRedeemModal() {
    document.getElementById('redeemModal').style.display = 'none';
}

function openEditModal(investmentId, brokerName, brokerId, investmentTypeId, investmentName) {
    document.getElementById('editInvestmentId').value = investmentId;
    document.getElementById('editInvestmentNameDisplay').value = brokerName + ' - ' + investmentName;
    document.getElementById('editBrokerId').value = brokerId;
    document.getElementById('editInvestmentTypeId').value = investmentTypeId;
    document.getElementById('editInvestmentName').value = investmentName;
    document.getElementById('editModal').style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

function openUpdateStatusModal(investmentId, investmentName, currentStatus) {
    document.getElementById('updateStatusInvestmentId').value = investmentId;
    document.getElementById('updateStatusInvestmentName').value = investmentName;
    document.getElementById('updateStatusStatus').value = currentStatus;
    document.getElementById('updateStatusModal').style.display = 'block';
}

function closeUpdateStatusModal() {
    document.getElementById('updateStatusModal').style.display = 'none';
}

// Fechar modais ao clicar fora
window.onclick = function(event) {
    const modals = ['allocateModal', 'updateBalanceModal', 'addContributionModal', 'redeemModal', 'editModal', 'updateStatusModal'];
    modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
}
</script>

{% endblock %}

