{% extends "finance/base.html" %}
{% load static finance_extras %}

{% block content %}
<h1>Planejamento de Orçamento Mensal</h1>

<form method="get" action="">
  <label for="id_year">Ano:</label>
  <input type="number" id="id_year" name="year" value="{{ year }}" min="2020" max="2100">
  <label for="id_month">Mês:</label>
  <input type="number" id="id_month" name="month" value="{{ month }}" min="1" max="12">
  <button type="submit">Trocar mês</button>
</form>

<hr>

<form method="post" action="">
  {% csrf_token %}
  <input type="hidden" name="year" value="{{ year }}">
  <input type="hidden" name="month" value="{{ month }}">

  <h2>Orçamento para {{ month }}/{{ year }}</h2>

  <table border="1" cellspacing="0" cellpadding="4">
    <thead>
      <tr>
        <th>Categoria</th>
        <th>Subcategorias</th>
        <th>Orçado (R$)</th>
      </tr>
    </thead>
    <tbody>
      {% for cat in categories %}
        {% for subcat in cat.subcategories %}
          <tr>
            {% if forloop.first %}
              <td rowspan="{{ cat.subcategories|length }}" style="vertical-align: top; font-weight: bold;">
                {{ cat.category_name }}
              </td>
            {% endif %}
            <td>{{ subcat.name }}</td>
            <td>
              <input type="number"
                     name="budget_{{ subcat.id }}"
                     step="0.01"
                     min="0"
                     {% if subcat.budget_amount %}value="{{ subcat.budget_amount }}"{% endif %}>
            </td>
          </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>

  <p style="margin-top: 10px;">
    Deixe em branco para remover o orçamento daquela categoria.
  </p>

  <button type="submit">Salvar orçamento</button>
</form>

{% endblock %}
