{% extends "finance/base.html" %}
{% load static %}

{% block content %}
<h1>Cartões de Crédito</h1>

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

<h2>{% if editing_card_id %}Editar{% else %}Novo{% endif %} Cartão de Crédito</h2>

<form method="post" action="">
  {% csrf_token %}
  {% if editing_card_id %}
    <input type="hidden" name="action" value="edit">
    <input type="hidden" name="card_id" value="{{ editing_card_id }}">
  {% else %}
    <input type="hidden" name="action" value="create">
  {% endif %}

  <div>
    <label for="id_name">Nome do Cartão:</label>
    <input type="text" id="id_name" name="name" required
           value="{% for card in credit_cards %}{% if card.id == editing_card_id %}{{ card.name }}{% endif %}{% endfor %}">
  </div>

  <div>
    <label for="id_closing_day">Dia de Fechamento da Fatura:</label>
    <input type="number" id="id_closing_day" name="closing_day" min="1" max="31" required
           value="{% for card in credit_cards %}{% if card.id == editing_card_id %}{{ card.closing_day }}{% endif %}{% endfor %}">
  </div>

  <div>
    <label for="id_due_day">Dia de Vencimento da Fatura:</label>
    <input type="number" id="id_due_day" name="due_day" min="1" max="31" required
           value="{% for card in credit_cards %}{% if card.id == editing_card_id %}{{ card.due_day }}{% endif %}{% endfor %}">
  </div>

  <div style="margin-top: 12px;">
    <button type="submit">{% if editing_card_id %}Atualizar{% else %}Criar{% endif %}</button>
    {% if editing_card_id %}
      <a href="{% url 'finance:credit_cards' %}" style="margin-left: 10px;">Cancelar</a>
    {% endif %}
  </div>
</form>

<hr>

<h2>Cartões Cadastrados</h2>

{% if credit_cards %}
  <table border="1" cellspacing="0" cellpadding="4">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Dia de Fechamento</th>
        <th>Dia de Vencimento</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for card in credit_cards %}
        <tr>
          <td>{{ card.name }}</td>
          <td>{{ card.closing_day }}</td>
          <td>{{ card.due_day }}</td>
          <td>
            <a href="{% url 'finance:credit_cards' %}?edit={{ card.id }}">Editar</a> |
            <form method="post" action="" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja deletar este cartão?');">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="card_id" value="{{ card.id }}">
              <button type="submit" class="logout-link" style="color: #c62828;">Deletar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>Nenhum cartão de crédito cadastrado.</p>
{% endif %}

{% endblock %}

